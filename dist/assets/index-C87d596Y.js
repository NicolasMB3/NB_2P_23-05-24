var b=(l,e,t)=>{if(!e.has(l))throw TypeError("Cannot "+t)};var x=(l,e,t)=>{if(e.has(l))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(l):e.set(l,t)};var g=(l,e,t)=>(b(l,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var m,y;class M{constructor(e,t,s){x(this,m);this.MIN_WIDTH=500,this.MIN_HEIGHT=300,this.isFullScreen=!1,this.shiftX=null,this.zIndex=0,this.shiftY=null,this.activeWindow=null,this.isResizingWidth=!1,this.isResizingHeight=!1,this.animationFrameId=null,this.lastEvent=null,this.originalSize={width:"",height:"",top:"",left:""},this.icon=s,this.classWindows=e,this.windowElement=t}init(e){const t=e.querySelector(".controller");this.addMinimizeButtonListener(e),this.addExpandButtonListener(e),this.addCloseButtonListener(e),this.addControllerListeners(t,e),this.addWindowElementListeners(t,e),document.addEventListener("mouseup",()=>this.onMouseUp())}addMinimizeButtonListener(e){const t=e.querySelector(".minus");t.addEventListener("dblclick",s=>s.preventDefault()),t.addEventListener("click",()=>this.minimizeWindow(e,this.icon))}addExpandButtonListener(e){const t=e.querySelector(".expand");t.addEventListener("dblclick",s=>s.preventDefault()),t.addEventListener("click",()=>this.setFullScreen(e))}addCloseButtonListener(e){const t=e.querySelector(".close");t.addEventListener("dblclick",s=>s.preventDefault()),t.addEventListener("click",()=>this.closeWindow(e))}addControllerListeners(e,t){e.addEventListener("mousedown",s=>this.onMouseDown(e,t,s)),e.addEventListener("mouseup",()=>this.onMouseUp()),e.addEventListener("dblclick",()=>this.setFullScreen(t)),e.addEventListener("mouseleave",()=>this.onMouseLeave())}addWindowElementListeners(e,t){t.addEventListener("mousemove",s=>this.onMouseMoveCursor(s,t)),t.addEventListener("mousedown",s=>this.onWindowMouseDown(s,e,t))}bringToFront(e){e.style.zIndex=(++this.zIndex).toString()}closeWindow(){if(this.windowElement.querySelector("canvas.snake")){const t=this.windowElement.querySelector("canvas.snake").id,s=document.getElementById(t);s&&s.snakeGame&&s.snakeGame.stopGame()}this.windowElement.remove()}minimizeWindow(e,t){e.classList.add("minimized"),setTimeout(()=>{e.style.display="none"},500);const s=document.querySelector(".dock_content");let i=s.querySelector(`.active_dock[data-icon="${t}"]`);i||(i=document.createElement("div"),i.className="active_dock",i.dataset.icon=t,i.innerHTML=`<img class="window_dock_folder" src="${t}" alt="Image de fen√™tre">`,s.appendChild(i));const n=JSON.parse(i.dataset.windows||"[]"),o=i.cloneNode(!0);n.push(e.id),i.dataset.windows=JSON.stringify(n),i.parentNode.replaceChild(o,i),i=o,n.length===1?i.addEventListener("click",()=>{this.restoreWindow(e,i)}):i.addEventListener("click",()=>{const a=i.querySelector(".window-menu");a?a.remove():this.showWindowMenu(i)})}showWindowMenu(e){const t=JSON.parse(e.dataset.windows||"[]"),s=document.createElement("div");s.className="window-menu",s.innerHTML="",t.forEach(i=>{const n=document.createElement("div");n.textContent=i,n.addEventListener("click",()=>{this.restoreWindow(document.getElementById(i),e);const o=e.querySelector(".window-menu");o&&o.remove()}),s.appendChild(n)}),e.appendChild(s)}restoreWindow(e,t){e.classList.remove("minimized"),e.style.display="block";const s=JSON.parse(t.dataset.windows||"[]");if(t.dataset.windows=JSON.stringify(s.filter(i=>i!==e.id)),s.length<=1)t.remove();else{const i=t.querySelector(".window-menu");i&&i.remove()}}setFullScreen(e){const t=document.querySelector(".navigation").offsetHeight;this.isFullScreen?(e.style.width=this.originalSize.width,e.style.height=this.originalSize.height,e.style.top=this.originalSize.top,e.style.left=this.originalSize.left,e.classList.add("fullScreen"),this.isFullScreen=!1):(this.originalSize={width:e.style.width,height:e.style.height,top:e.style.top,left:e.style.left},this.bringToFront(e),e.style.top=t+"px",e.style.left="0px",e.style.width=window.innerWidth+"px",e.style.height=e.parentElement.clientHeight+"px",e.classList.add("fullScreen"),this.isFullScreen=!0),requestAnimationFrame(()=>{const s=e.querySelector("#snake");if(s){s.width=e.offsetWidth,s.height=e.offsetHeight-e.querySelector(".controller").offsetHeight;const i=s.snakeGame;i&&!i.gameOver&&(i.apple.left=Math.min(i.apple.left,s.width-10),i.apple.top=Math.min(i.apple.top,s.height-10),i.snake=i.snake.map(n=>({left:Math.min(n.left,s.width-10),top:Math.min(n.top,s.height-10)})))}}),e.classList.remove("fullScreen"),e.addEventListener("transitionend",()=>{e.classList.remove("fullScreen")})}resizeWidth(e){const s=this.activeWindow.parentElement.getBoundingClientRect(),i=this.activeWindow.getBoundingClientRect(),n=e.pageX-i.left,o=s.width-i.left;this.activeWindow.style.width=Math.min(Math.max(n,this.MIN_WIDTH),o)+"px",this.classWindows.bringToFront(this);const a=this.activeWindow.querySelector("#snake");a&&(a.width=n)}resizeHeight(e){const s=this.activeWindow.parentElement.getBoundingClientRect(),i=this.activeWindow.getBoundingClientRect(),n=e.pageY-i.top,o=s.height-i.top;this.activeWindow.style.height=Math.min(Math.max(n,this.MIN_HEIGHT),o)+"px",this.classWindows.bringToFront(this);const a=this.activeWindow.querySelector("#snake");a&&(a.height=n)}move(){if(this.activeWindow&&!this.isResizingWidth&&!this.isResizingHeight&&this.lastEvent){const t=this.activeWindow.parentElement.getBoundingClientRect(),s=document.querySelector(".navigation").offsetHeight,i=this.lastEvent.pageX-this.shiftX,n=this.lastEvent.pageY-this.shiftY,o=i+this.activeWindow.offsetWidth,a=n+this.activeWindow.offsetHeight;i>=0&&o<=t.width?this.activeWindow.style.left=i+"px":i<0?this.activeWindow.style.left="0px":o>t.width&&(this.activeWindow.style.left=t.width-this.activeWindow.offsetWidth+"px"),n>=s&&a<=t.height+s?this.activeWindow.style.top=n+"px":n<s?this.activeWindow.style.top=s+"px":a>t.height+s&&(this.activeWindow.style.top=t.height+s-this.activeWindow.offsetHeight+"px")}}onMouseUp(){this.activeWindow=null,this.isResizingWidth=!1,this.isResizingHeight=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}onMouseMove(e){this.lastEvent=e,this.activeWindow&&!this.isResizingWidth&&!this.isResizingHeight&&(this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.animationFrameId=requestAnimationFrame(()=>this.move()))}onResizeMove(e){this.isResizingWidth?this.resizeWidth(e):this.isResizingHeight&&this.resizeHeight(e)}handleMouseDown(e,t,s){const{mouseX:i,mouseY:n,windowWidth:o,windowHeight:a}=g(this,m,y).call(this,e,s);this.shiftX=i,this.shiftY=n,i>o*.98?(this.isResizingWidth=!0,this.isResizingHeight=!1):n>a*.98?(this.isResizingWidth=!1,this.isResizingHeight=!0):e.target===t&&(s.style.position="absolute",this.bringToFront(s),document.addEventListener("mousemove",r=>this.onMouseMove(r))),this.activeWindow=s,document.addEventListener("mousemove",r=>this.onResizeMove(r))}onMouseDown(e,t,s){this.handleMouseDown(s,e,t),this.classWindows.bringToFront(this)}onWindowMouseDown(e,t,s){const{mouseX:i,mouseY:n,windowWidth:o,windowHeight:a}=g(this,m,y).call(this,e,s);i>o*.98||n>a*.98?(this.isResizingWidth=i>o*.98,this.isResizingHeight=n>a*.98,this.activeWindow=s,document.addEventListener("mousemove",r=>this.onResizeMove(r))):e.target===t&&this.handleMouseDown(e,t,s)}onMouseMoveCursor(e,t){const{mouseX:s,mouseY:i,windowWidth:n,windowHeight:o}=g(this,m,y).call(this,e,t);s>n*.98?document.body.style.cursor="ew-resize":i>o*.98?document.body.style.cursor="ns-resize":document.body.style.cursor="default"}onMouseLeave(){document.body.style.cursor="default"}}m=new WeakSet,y=function(e,t){const s=t.getBoundingClientRect(),i=e.clientX-s.left,n=e.clientY-s.top,o=s.width,a=s.height;return{mouseX:i,mouseY:n,windowWidth:o,windowHeight:a}};const E=l=>`
        <div id="param1_content" class="${l}">
            <h2>Param√®tres</h2>
            <div>
                <label for="theme">Fond d'√©cran</label>
                <select name="theme" id="theme">
                    <option value="pattern">Pattern</option>
                    <option value="organic">Organic</option>
                </select>
            </div>
            <div>
                <label for="icon-size-slider">Taille des ic√¥nes :</label>
                <input type="range" id="icon-size-slider" min="10" max="100" value="50">
            </div>
        </div>
    `,T=l=>`
        <div id="param1_content" class="${l}">
            <p>Param√®tres 2</p>
        </div>
    `,A=l=>{const e=JSON.parse(localStorage.getItem("keys"))||{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"},t=localStorage.getItem("snakeColor")||"#ffffff",s={ArrowUp:"‚Üë",ArrowDown:"‚Üì",ArrowLeft:"‚Üê",ArrowRight:"‚Üí"},i=s[e.up]||e.up,n=s[e.down]||e.down,o=s[e.left]||e.left,a=s[e.right]||e.right;return`
        <div id="param7_content" class="${l}">
            <h2>Param√®tres du jeu Snake üêç</h2>
            <div class="map-container">
                <div class="key-label"></div>
                <div class="key-input toucheH" id="up-key" tabindex="0">${i}</div>
                <div class="key-label"></div>
                <div class="key-input toucheG" id="left-key" tabindex="0">${o}</div>
                <div class="key-input toucheB" id="down-key" tabindex="0">${n}</div>
                <div class="key-input toucheD" id="right-key" tabindex="0">${a}</div>
            </div>
            <div>
                <label for="snake-color">Couleur du serpent :</label>
                <input type="color" id="snake-color" name="snake-color" value="${t}">
            </div>
        </div>
    `},H={ArrowUp:"‚Üë",ArrowDown:"‚Üì",ArrowLeft:"‚Üê",ArrowRight:"‚Üí"};class W{constructor(){this.windows=[],this.highestZIndex=0,this.contentParams={param1:E("test"),param2:T("test 2"),param4:A("test 2")}}addWindow(e){this.windows.push(e)}createWindowElement(e,t,s,i){return`
            <div class="window position-${e} ${s==="Snake"?"snake-window":""}" data-name="${s}" style="--random-color: ${this.getRandomColor()}">
                <div class="controller block_highlights">
                    <p>${s}</p>
                    <div class="icon_controller">
                        <span class="minus"></span>
                        <span class="expand"></span>
                        <span class="close"></span>
                    </div>
                </div>
                <div class="content">
                    ${i}
                </div>
            </div>
        `}getRandomColor(){let e=Math.floor(Math.random()*16777215).toString(16);for(;e.length<6;)e="0"+e;return"#"+e}createNewWindow(e,t,s,i){const n=typeof i=="function"?i():i,o=this.createWindowElement(e,t,s,n);document.querySelector(".windows_area").insertAdjacentHTML("beforeend",o);const a=document.querySelector(".windows_area").lastElementChild,r=new M(this,a,t);return this.addWindow(r),a.id=`window-${Date.now()}`,r.init(a),this.bringToFront(r),this.addNavigationClickHandler(a),a}addNavigationClickHandler(e){const t=e.querySelector(".param_nav"),s=e.querySelector(".param_content");t&&t.addEventListener("click",i=>{if(i.target.tagName==="LI"){const n=i.target.getAttribute("id");s.innerHTML=this.contentParams[n]||"",this.addBackgroundChangeHandler(e);const o=e.querySelector("#snake-color");o&&o.addEventListener("change",r=>{this.changeSnakeColor(r.target.value)}),e.querySelectorAll(".key-input").forEach(r=>{r.addEventListener("keydown",d=>{d.preventDefault();const h=d.key;r.textContent=H[h]||h;const c={up:e.querySelector("#up-key").textContent==="‚Üë"?"ArrowUp":e.querySelector("#up-key").textContent,down:e.querySelector("#down-key").textContent==="‚Üì"?"ArrowDown":e.querySelector("#down-key").textContent,left:e.querySelector("#left-key").textContent==="‚Üê"?"ArrowLeft":e.querySelector("#left-key").textContent,right:e.querySelector("#right-key").textContent==="‚Üí"?"ArrowRight":e.querySelector("#right-key").textContent};this.changeKeySnake(c)})})}})}changeSnakeColor(e){localStorage.setItem("snakeColor",e)}changeBackground(e){document.body.style.backgroundImage=`url('/${e}.png')`}changeKeySnake(e){localStorage.setItem("keys",JSON.stringify(e))}addBackgroundChangeHandler(e){const t=e.querySelector("#theme");t&&t.addEventListener("change",s=>{this.changeBackground(s.target.value)})}bringToFront(e){e.zIndex=++this.highestZIndex,e.windowElement.style.zIndex=this.highestZIndex}}class q{constructor(){this.notifications=[],this.notificationContainer=document.querySelector(".notification-center"),this.timeOutNotification=6e4}addNotification(e){this.notifications.push(e),this.notificationContainer.appendChild(e)}createNotificationElement(e,t){const s=document.createElement("div"),i=document.createElement("h2"),n=document.createElement("div"),o=document.createElement("div");return i.textContent=e,n.textContent=t,o.appendChild(i),o.appendChild(n),o.classList.add("notification-content"),s.className="notification",s.appendChild(o),s}addNotificationButton(e,t,s){t.addEventListener("click",()=>{s&&s(),this.notificationContainer.removeChild(e)}),e.appendChild(t)}setNotificationColor(e,t){t&&e.style.setProperty("--notification-color",t)}displayNotification(e,t,s=null,i=null,n=null){const o=this.createNotificationElement(e,t);s&&this.addNotificationButton(o,s,i),this.setNotificationColor(o,n),this.addNotification(o),this.removeTimeoutNotification(o)}removeTimeoutNotification(e){setTimeout(()=>{const t=this.notifications.indexOf(e);if(t>-1){this.notifications.splice(t,1);const s=e.querySelector(".replay-button");s&&s.remove(),e.remove()}},this.timeOutNotification)}}class P{constructor(e){this.canvasId=e,this.canvas=null,this.context=null,this.snake=[{top:200,left:200}],this.direction="right",this.apple=null,this.gameOver=!1,this.walls=[],this.board=[],this.speed=100,this.fastSpeed=40,this.fastModeStartTime=null,this.currentSpeed=this.speed,this.speedTimeout=null,this.lastWallScore=0,this.goldenApple=null,this.goldenAppleTimeout=null,this.lastTime=Date.now(),this.isPaused=!1,this.lastTailPosition=null,this.gameLoop=this.gameLoop.bind(this),this.snakeColor="#0e881f",this.keyIsDown=!1}init(){this.setupCanvas(),this.setupGame(),this.setupEventHandlers(),this.gameLoop()}setupCanvas(){this.canvas=document.getElementById(this.canvasId),this.context=this.canvas.getContext("2d"),this.board=Array(this.canvas.width/10).fill(void 0,void 0,void 0).map(()=>Array(this.canvas.height/10).fill(0)),this.createPauseOverlay(),this.snakeColor=localStorage.getItem("snakeColor")||"#0e881f",this.canvas.parentElement.appendChild(this.pauseOverlay)}setupGame(){this.draw(),this.update(),this.snake=[{top:200,left:200}],this.walls=[],this.apple=null,this.direction="right",this.gameOver=!1}setupEventHandlers(){let e=localStorage.getItem("keys");e=e?JSON.parse(e):{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"},this.keydownHandler&&window.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=this.createKeydownHandler(e),window.addEventListener("keydown",this.keydownHandler),this.keyupHandler&&window.removeEventListener("keyup",this.keyupHandler),this.keyupHandler=this.createKeyupHandler(e),window.addEventListener("keyup",this.keyupHandler),this.keydownPauseHandler&&window.removeEventListener("keydown",this.keydownPauseHandler),this.keydownPauseHandler=t=>this.handleKeyDown(t),window.addEventListener("keydown",this.keydownPauseHandler)}createKeydownHandler(e){return t=>{const s=Object.keys(e).find(i=>e[i].toLowerCase()===t.key.toLowerCase());s&&this.changeDirection(s,e),!this.speedTimeout&&!this.keyIsDown&&this.direction===s&&(this.keyIsDown=!0,this.fastModeStartTime=Date.now(),this.speedTimeout=setTimeout(()=>{this.currentSpeed=this.fastSpeed,this.speedTimeout=null},100))}}createKeyupHandler(e){return t=>{if(this.keyIsDown=!1,this.changeDirection(t.key,e),this.speedTimeout&&(clearTimeout(this.speedTimeout),this.speedTimeout=null),this.fastModeStartTime){const s=Date.now()-this.fastModeStartTime;if(s>1e3){const i=Math.floor(s/1e3);this.snake.length=Math.max(1,this.snake.length-i)}this.fastModeStartTime=null}this.currentSpeed=this.speed}}createPauseOverlay(){this.pauseOverlay=document.createElement("div"),this.pauseOverlay.style.position="absolute",this.pauseOverlay.style.top="40px",this.pauseOverlay.style.left="0",this.pauseOverlay.style.width="100%",this.pauseOverlay.style.height="calc(100% - 40px)",this.pauseOverlay.style.display="none",this.pauseOverlay.style.borderRadius="0 0 10px 10px",this.pauseOverlay.style.justifyContent="center",this.pauseOverlay.style.alignItems="center",this.pauseOverlay.style.backgroundColor="rgba(255, 255, 255, 0.2)",this.pauseOverlay.style.backdropFilter="blur(8px)",this.pauseOverlay.innerHTML='<img class="pause" src="/pause.svg" alt="Pause">'}drawScore(){this.context.fillStyle="black",this.context.font="16px Arial";const e=this.snake.length-1;this.context.fillText("Score: "+e,10,30);const t=localStorage.getItem("bestScore")||0;this.context.fillText("Meilleur score: "+t,120,30)}updateBestScore(){const e=this.snake.length-1,t=localStorage.getItem("bestScore")||0;e>t&&localStorage.setItem("bestScore",e.toString())}gameLoop(e){if(this.isPaused){requestAnimationFrame(t=>this.gameLoop(t));return}if(!this.gameOver){const t=Date.now(),s=t-this.lastTime;s>this.currentSpeed&&(this.lastTime=t-s%this.currentSpeed,this.update()),this.draw()}requestAnimationFrame(t=>this.gameLoop(t))}draw(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.snakeColor,this.lastTailPosition&&this.context.clearRect(this.lastTailPosition.left,this.lastTailPosition.top,10,10),this.snake.forEach((e,t)=>{this.context.fillRect(e.left,e.top,10,10),t===0&&(this.context.fillStyle="white",this.direction==="right"||this.direction==="left"?(this.context.fillRect(e.left+2,e.top+2,2,2),this.context.fillRect(e.left+6,e.top+2,2,2)):(this.context.fillRect(e.left+2,e.top+2,2,2),this.context.fillRect(e.left+2,e.top+6,2,2)),this.context.fillStyle=this.snakeColor)}),this.apple&&(this.context.beginPath(),this.context.arc(this.apple.left+5,this.apple.top+5,5,0,Math.PI*2,!0),this.context.closePath(),this.context.fillStyle="red",this.context.fill(),this.context.fillStyle="green",this.context.fillRect(this.apple.left+2,this.apple.top-2,3,2),this.context.fillRect(this.apple.left+5,this.apple.top-2,3,2)),this.goldenApple&&(this.context.beginPath(),this.context.arc(this.goldenApple.left+5,this.goldenApple.top+5,5,0,Math.PI*2,!0),this.context.closePath(),this.context.fillStyle="gold",this.context.fill(),this.context.fillStyle="green",this.context.fillRect(this.goldenApple.left+2,this.goldenApple.top-2,3,2),this.context.fillRect(this.goldenApple.left+5,this.goldenApple.top-2,3,2)),this.drawScore(),this.context.fillStyle="black",this.walls.forEach(e=>{this.context.fillRect(e.left,e.top,10,10)})}checkSelfCollision(){const e=this.snake[0];return this.board[e.left/10][e.top/10]===1}update(){const e=this.calculateNewHeadPosition();if(this.isOutOfBounds(e)){this.handleGameOver();return}this.updateBoard(),this.snake.unshift(e),this.updateOccupiedPositions(),this.apple&&this.isAppleEaten(e)?this.apple=null:(this.updateTailPosition(),this.snake.pop()),this.goldenApple&&this.isGoldenAppleEaten(e)&&(this.extendSnake(),this.removeGoldenApple()),(this.checkSelfCollision()||this.checkWallCollision())&&this.handleGameOver(),this.apple||this.generateApple(),this.generateWalls(),this.updateBestScore()}calculateNewHeadPosition(){const e=Object.assign({},this.snake[0]);switch(this.direction){case"left":e.left-=10;break;case"up":e.top-=10;break;case"right":e.left+=10;break;case"down":e.top+=10;break}return e}isOutOfBounds(e){return e.left<0||e.left>=this.canvas.width||e.top<0||e.top>=this.canvas.height}updateBoard(){this.board=this.board.map((e,t)=>e.map((s,i)=>this.snake.some(n=>n.left===t*10&&n.top===i*10)?1:this.apple&&this.apple.left===t*10&&this.apple.top===i*10?2:this.goldenApple&&this.goldenApple.left===t*10&&this.goldenApple.top===i*10?3:this.walls.some(n=>n.left===t*10&&n.top===i*10)?4:0))}updateOccupiedPositions(){this.occupiedPositions=new Set(this.snake.map(e=>`${e.left},${e.top}`)),this.walls.forEach(e=>this.occupiedPositions.add(`${e.left},${e.top}`))}isAppleEaten(e){return this.apple.top===e.top&&this.apple.left===e.left}updateTailPosition(){this.lastTailPosition={...this.snake[this.snake.length-1]}}isGoldenAppleEaten(e){return this.goldenApple.top===e.top&&this.goldenApple.left===e.left}extendSnake(){for(let e=0;e<5;e++){const t=this.snake[this.snake.length-1];this.snake.push({top:t.top,left:t.left})}}removeGoldenApple(){clearTimeout(this.goldenAppleTimeout),this.goldenApple=null,this.goldenAppleTimeout=null}changeDirection(e,t){const s=e.toLowerCase(),i={up:t.up.toLowerCase(),down:t.down.toLowerCase(),left:t.left.toLowerCase(),right:t.right.toLowerCase()};switch(s){case i.up:this.direction="up";break;case i.down:this.direction="down";break;case i.left:this.direction="left";break;case i.right:this.direction="right";break}}checkWallCollision(){const e=this.snake[0];return this.board[e.left/10][e.top/10]===4}stopGame(){this.gameOver=!0}generateWalls(){const e=this.snake.length-1;if(e>=10&&e-this.lastWallScore>=10){const t=Math.pow(e,1);for(let s=0;s<t;s++)this.walls.push({top:Math.floor(Math.random()*this.canvas.height/10)*10,left:Math.floor(Math.random()*this.canvas.width/10)*10});this.lastWallScore=e}}generateApple(){const e=this.getFreePositions(),t=Math.floor(Math.random()*e.length);if(this.apple=e[t],Math.random()<.1){const s=Math.floor(Math.random()*e.length);this.goldenApple=e[s],this.goldenAppleTimeout=setTimeout(()=>this.removeGoldenApple(),6e3)}this.board[this.apple.left/10][this.apple.top/10]=2}getFreePositions(){const e=[];for(let t=0;t<this.board.length;t++)for(let s=0;s<this.board[0].length;s++)this.board[t][s]===0&&e.push({left:t*10,top:s*10});return e}handleGameOver(){if(!this.gameOver){this.gameOver=!0;const e=new q,t=document.createElement("button"),s=this.canvas.closest(".window"),n=getComputedStyle(s).getPropertyValue("--random-color");let o=this.canvas.parentElement.querySelector(".replay-button");t.textContent="Rejouer",o||e.displayNotification("Game Over","Score: "+(this.snake.length-1),t,null,n),t.onclick=null,t.addEventListener("click",()=>this.restartGame()),this.updateBestScore()}}handleKeyDown(e){(e.key==="p"||e.key==="P")&&(this.isPaused=!this.isPaused,this.isPaused?this.pauseOverlay.style.display="flex":(this.pauseOverlay.style.display="none",this.gameLoop()))}restartGame(){const e=this.canvas.width,t=this.canvas.height,s=document.createElement("canvas");s.id=this.canvasId,s.classList.add("snake"),s.width=e,s.height=t,this.canvas.replaceWith(s),this.canvas=s,this.pauseOverlay.remove(),this.init()}}class L{constructor(e){this.desktop=e,this.trash=[]}onTrashDrop(e){e.preventDefault();const t=e.dataTransfer.getData("text/plain"),s=document.querySelector(`.desktop-folder[data-name="${t}"]`);s&&s.dataset.name!=="Poubelle"&&this.removeFolderAndWindow(s)}moveSelectedFoldersToTrash(){this.desktop.selectedFolders.forEach(e=>{if(e.dataset.name!=="Poubelle"){this.trash.push(e),e.remove();const[t,s]=this.desktop.getFolderPosition(e);this.desktop.grid[t][s]=0;const i=document.querySelector(`.window[data-name="${e.dataset.name}"]`);i&&i.remove()}}),this.desktop.selectedFolders=[]}addRestoreEvent(e){const t=s=>{const i=this.desktop.createContextMenu(s,e);i.querySelector(".restore").addEventListener("click",()=>{this.trash=this.trash.filter(o=>o.dataset.name!==e.dataset.name),this.desktop.setFolderPosition(e),e.setAttribute("draggable","true"),document.querySelector(".windows_area").appendChild(e),i.remove(),this.updateTrashWindowContent(),e.removeEventListener("contextmenu",t),this.moveToTrash(e);const n=this.desktop.content[e.dataset.name];this.desktop.addDoubleClickEvent(e,e.dataset.name,n,"icon_du_dossier"),e.closest(".window")&&e.closest(".window").removeChild(e),this.desktop.addDragEvents(e,e.dataset.name)}),document.body.appendChild(i)};e.addEventListener("contextmenu",t)}removeFolderAndWindow(e){this.trash.push(e),e.remove();const t=new CustomEvent("trashUpdated");document.dispatchEvent(t);const[s,i]=this.desktop.getFolderPosition(e);this.desktop.grid[s][i]=0;const n=document.querySelector(`.window[data-name="${e.dataset.name}"]`);n&&n.remove()}moveToTrash(e){e.dataset.name!=="Poubelle"&&e.addEventListener("contextmenu",t=>{const s=this.desktop.createContextMenu(t,e);s.querySelector(".delete").addEventListener("click",()=>{this.removeFolderAndWindow(e),s.remove()}),document.body.appendChild(s)})}emptyBin(){this.trash=[],this.updateTrashWindowContent()}updateTrashWindowContent(){const e=document.querySelectorAll('.window[data-name="Poubelle"]');e&&e.forEach(t=>{t.querySelector(".content").innerHTML=this.trash.map(s=>this.desktop.createFolderElement(s.dataset.name,s.querySelector("img").src).outerHTML).join(""),this.trash.forEach((s,i)=>{const n=t.querySelector(`.desktop-folder:nth-child(${i+1})`);this.addRestoreEvent(n)})})}}class F{constructor(e){this.windows=e,this.selectedFolders=[],this.originalPositions={},this.content={},this.isSelecting=!1,this.selectionBox=null,this.grid=this.createGrid(),this.startX=0,this.startY=0,this.iconSize=40,this.draggedFolderName=null,this.windowsArea=document.querySelector(".windows_area"),this.navigation=document.querySelector(".navigation"),this.hierarchy=new L(this),this.setLocalStorageKeys(),this.init()}init(){this.windowsArea.addEventListener("mousedown",e=>{this.removeSelection(e),this.startSelection(e)}),this.windowsArea.addEventListener("mousemove",e=>this.updateSelection(e)),this.windowsArea.addEventListener("mouseup",e=>this.endSelection(e)),document.addEventListener("keydown",e=>this.handleKeyDown(e)),this.launchSnakeOnWindowOpen(),this.setupDragAndDrop()}setLocalStorageKeys(){const e={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"};localStorage.setItem("keys",JSON.stringify(e))}createGrid(){return Array(5).fill(void 0,void 0,void 0).map(()=>Array(5).fill(0))}setIconSize(e){this.iconSize=e}updateIconSize(){document.querySelectorAll(".desktop-folder img").forEach(t=>{t.style.width=`${this.iconSize}px`,t.style.height=`${this.iconSize}px`})}handleKeyDown(e){e.key==="Delete"&&this.hierarchy.moveSelectedFoldersToTrash()}createLN(e,t,s,i){const n=this.createFolderElement(e,s,i);this.setFolderPosition(n),this.addDragEvents(n,e),this.content[e]=t,e==="Poubelle"?(this.addDoubleClickEventTrash(n,e,t,s),this.addContextMenuEvent(n),n.addEventListener("drop",o=>this.hierarchy.onTrashDrop(o)),document.addEventListener("trashUpdated",()=>{this.hierarchy.updateTrashWindowContent()})):this.addDoubleClickEvent(n,e,t,s),document.querySelector(".windows_area").appendChild(n),this.hierarchy.moveToTrash(n)}addContextMenuEvent(e){e.addEventListener("contextmenu",t=>{this.createContextMenu(t,e)})}addDoubleClickEventTrash(e,t,s,i){e.addEventListener("dblclick",()=>{const n=this.hierarchy.trash.map(a=>this.createFolderElement(a.dataset.name,a.querySelector("img").src).outerHTML).join(""),o=this.windows.createNewWindow("center",i,t,n);this.hierarchy.trash.forEach((a,r)=>{const d=o.querySelector(`.desktop-folder:nth-child(${r+1})`);this.hierarchy.addRestoreEvent(d)})})}updateGrid(e){const t=e.dataset.name,s=this.getFolderPosition(e);if(s){const[h,c]=s;this.grid[h][c]=0}const i=e.getBoundingClientRect(),n=135,o=10,a=document.querySelector(".navigation").offsetHeight,r=Math.floor(i.left/(n+o)),d=Math.floor((i.top-a)/(n+o));r>=0&&r<this.grid.length&&d>=0&&d<this.grid[r].length&&(this.grid[r][d]=t)}launchSnake(){const e=document.createElement("canvas");return e.id="snake",e.classList.add("snake"),e.outerHTML}launchSnakeOnWindowOpen(){const e=document.querySelector(".windows_area");let t=0;e.addEventListener("DOMNodeInserted",s=>{const i=s.target;if(i.nodeType===Node.ELEMENT_NODE&&i.classList.contains("window")&&i.dataset.name==="Snake"){const n=i.querySelector("#snake");if(n&&(t++,n.id=`snake-${t}`,n.width=i.offsetWidth,n.height=i.offsetHeight-i.querySelector(".controller").offsetHeight,n.getContext)){const o=new P(n.id);o.init(),n.snakeGame=o}}})}createContextMenu(e,t){e.preventDefault();const s=document.querySelector(".context-menu");s&&s.remove();const i=document.createElement("div");return i.style.position="absolute",i.style.left=`${e.pageX}px`,i.style.top=`${e.pageY}px`,i.classList.add("context-menu"),t.dataset.name==="Poubelle"?(i.innerHTML='<button class="empty-trash">Vider la corbeille</button>',i.querySelector(".empty-trash").addEventListener("click",()=>{this.hierarchy.emptyBin(),i.remove()})):i.innerHTML='<button class="delete">Supprimer</button><button class="restore">Restaurer</button>',document.body.appendChild(i),document.addEventListener("mousedown",function n(o){o.target.closest(".context-menu")||(i.remove(),document.removeEventListener("mousedown",n))}),i}createFolderElement(e,t,s){const i=document.createElement("div"),n=document.createElement("img"),o=document.createElement("div");return i.classList.add("desktop-folder","block_highlights"),i.dataset.name=e,i.dataset.type=s,i.childrenFolders={},n.src=t,n.alt=e,n.style.width=`${this.iconSize}px`,n.style.height=`${this.iconSize}px`,i.appendChild(n),o.textContent=e,i.appendChild(o),i}setFolderPosition(e){const t=this.findFreePosition();if(t){const[s,i]=t;this.grid[s][i]=e.dataset.name;const n=135,o=10,a=i*(n+o)+document.querySelector(".navigation").offsetHeight,r=s*(n+o);e.style.position="absolute",e.style.left=`${r}px`,e.style.top=`${a}px`}else console.error("Aucune position de disponible sur le bureau.")}getFolderPosition(e){const t=e.dataset.name;for(let s=0;s<this.grid.length;s++)for(let i=0;i<this.grid[s].length;i++)if(this.grid[s][i]===t)return[s,i];return null}findFreePosition(){for(let e=0;e<this.grid.length;e++)for(let t=0;t<this.grid[e].length;t++)if(this.grid[e][t]===0)return[e,t];return null}addDragEvents(e,t){if(e.draggable=!0,e.closest(".window"))return;e.querySelector("img").addEventListener("mousedown",i=>{i.stopPropagation()}),e.addEventListener("dragstart",i=>{i.dataTransfer.setData("text/plain",t),this.draggedFolderName=t,e.classList.add("dragging"),this.draggedFolder=e,e.classList.contains("selected")||(this.selectedFolders.forEach(n=>{n.classList.remove("selected")}),this.selectedFolders=[]),this.previewElement=e.cloneNode(!0),this.previewElement.classList.add("folder-preview"),this.previewElement.style.position="absolute",document.querySelector(".windows_area").appendChild(this.previewElement)}),e.addEventListener("dragover",i=>{i.preventDefault(),(e.dataset.type==="folder"||e.dataset.type==="game")&&e.classList.add("over")}),e.addEventListener("dragleave",()=>{e.classList.remove("over")}),e.addEventListener("drop",i=>{i.preventDefault();const n=i.dataTransfer.getData("text/plain"),o=document.querySelector(`.desktop-folder[data-name="${n}"]`);if(t===n){e.classList.remove("over");return}(e.dataset.type==="folder"||e.dataset.type==="game")&&(o.dataset.type!=="system"||n==="Snake")&&(e.childrenFolders[n]=o,o.style.display="none"),e.classList.remove("over")}),e.addEventListener("dragend",()=>{e.classList.remove("dragging"),this.updateGrid(e),this.previewElement&&(this.previewElement.remove(),this.previewElement=null)})}setupDragAndDrop(){const e=document.querySelector(".windows_area");e.addEventListener("dragover",t=>{t.preventDefault();const s=this.draggedFolderName,i=document.querySelector(`.desktop-folder[data-name="${s}"]`);if(!i||i.closest(".window"))return;this.previewElement||(this.previewElement=i.cloneNode(!0),this.previewElement.classList.add("folder-preview"),this.previewElement.style.position="absolute",e.appendChild(this.previewElement));const n=135,o=10;let a=Math.floor(t.clientX/(n+o))*(n+o),r=Math.floor(t.clientY/(n+o))*(n+o);const d=e.getBoundingClientRect();if(a=Math.min(Math.max(a,0),d.width-n),r=Math.min(Math.max(r,0),d.height-n),r+=document.querySelector(".navigation").offsetHeight,this.selectedFolders.length>1){const h=a-parseInt(this.draggedFolder.style.left),c=r-parseInt(this.draggedFolder.style.top);this.selectedFolders.forEach(u=>{u.style.left=`${parseInt(u.style.left)+h}px`,u.style.top=`${parseInt(u.style.top)+c}px`})}else i.style.left=`${a}px`,i.style.top=`${r}px`;this.previewElement.style.left=`${a}px`,this.previewElement.style.top=`${r}px`}),e.addEventListener("drop",t=>{t.preventDefault();const s=this.draggedFolderName;document.querySelector(`.desktop-folder[data-name="${s}"]`)&&(this.selectedFolders.forEach(n=>{const o=n.getBoundingClientRect(),a=e.getBoundingClientRect();if(o.left<a.left||o.right>a.right||o.top<a.top||o.bottom>a.bottom){const r=this.findFreePosition();if(r){const[d,h]=r;this.grid[d][h]=n.dataset.name;const c=135,u=10,S=h*(c+u)+document.querySelector(".navigation").offsetHeight,k=d*(c+u);n.style.left=`${k}px`,n.style.top=`${S}px`}}this.updateGrid(n)}),this.draggedFolderName=null,this.previewElement&&(this.previewElement.remove(),this.previewElement=null),this.draggedFolder=null)})}addDoubleClickEvent(e,t,s,i){e.addEventListener("dblclick",()=>{if(e.childrenFolders=e.childrenFolders||{},e.dataset.type==="folder"||e.dataset.type==="game"){const n=Object.values(e.childrenFolders);if(n.length>0){let o="";n.forEach(r=>{const d=this.createFolderElement(r.dataset.name,r.querySelector("img").src,r.dataset.type);o+=d.outerHTML});const a=this.windows.createNewWindow("center",i,t,o);n.forEach((r,d)=>{const h=a.querySelector(`.desktop-folder:nth-child(${d+1})`);this.addDoubleClickEvent(h,h.dataset.name,this.content[h.dataset.name],"icon_du_dossier")})}else{let o;typeof s=="function"?o=s():o=s,this.windows.createNewWindow("center",i,t,o)}}else{let n;typeof s=="function"?n=s():n=s,this.windows.createNewWindow("center",i,t,n)}})}startSelection(e){if(e.target.closest(".desktop-folder")||e.button!==0)return;const t=document.querySelector(".navigation").offsetHeight,s=document.querySelector(".dock").offsetHeight,i=window.innerHeight-s;if(e.clientY<t||e.clientY>i)return;const n=document.elementFromPoint(e.clientX,e.clientY);if(n.closest(".window")||n.closest(".window-menu"))return;this.isSelecting=!0,this.startX=e.clientX,this.startY=e.clientY,this.selectionBox=document.createElement("div"),this.selectionBox.style.position="absolute",this.selectionBox.style.left=`${this.startX}px`,this.selectionBox.style.top=`${this.startY}px`,this.selectionBox.style.border="1px solid rgba(12, 36, 97,1.0)",this.selectionBox.style.background="rgba(74, 105, 189,0.3)",this.selectionBox.style.pointerEvents="none",document.querySelectorAll(".window").forEach(a=>a.classList.add("no-select")),document.body.appendChild(this.selectionBox)}updateSelection(e){if(!this.isSelecting)return;const t=document.querySelector(".dock").offsetHeight,s=window.innerHeight-t,i=Math.min(Math.max(e.clientY,this.navigation.offsetHeight),s),n=e.clientX,o=Math.abs(n-this.startX),a=Math.abs(i-this.startY),r=Math.min(n,this.startX),d=Math.min(i,this.startY);this.selectionBox.style.width=`${o}px`,this.selectionBox.style.height=`${a}px`,this.selectionBox.style.left=`${r}px`,this.selectionBox.style.top=`${d}px`,document.querySelectorAll(".desktop-folder").forEach(c=>{const u=c.getBoundingClientRect();!(u.right<this.selectionBox.offsetLeft||u.left>this.selectionBox.offsetLeft+this.selectionBox.offsetWidth||u.bottom<this.selectionBox.offsetTop||u.top>this.selectionBox.offsetTop+this.selectionBox.offsetHeight)?this.selectedFolders.includes(c)||(c.classList.add("selected"),this.selectedFolders.push(c),this.originalPositions[c.dataset.name]={left:c.style.left,top:c.style.top}):(c.classList.remove("selected"),this.selectedFolders=this.selectedFolders.filter(k=>k!==c),delete this.originalPositions[c.dataset.name])})}removeSelection(e){e.target.closest(".desktop-folder")||(this.selectedFolders.forEach(t=>{t.classList.remove("selected")}),this.selectedFolders=[])}endSelection(){if(!this.isSelecting)return;document.querySelectorAll(".window").forEach(t=>t.classList.remove("no-select")),this.isSelecting=!1,document.body.removeChild(this.selectionBox),this.selectionBox=null}}class D{constructor(){this.updateDateTime(),setInterval(()=>this.updateDateTime(),3e4),this.dateElement=document.querySelector(".navigation .date-time"),this.dateElement.addEventListener("click",this.showNotificationCenter.bind(this)),this.notificationCenter=document.querySelector(".notification-center")}showNotificationCenter(){this.notificationCenter.style.display="block"}updateDateTime(){const e=new Date,t={day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"},s=document.querySelector(".navigation .date-time");let i=e.toLocaleDateString("fr-FR",t);i=i.replace("√†"," "),s.textContent=i}}const C=`
     <div class="param_nav">
        <ul>
            <li id="param1">Apparence</li>
            <li id="param2">Dock Proto</li>
            <li id="param3">Notifications</li>
            <li id="param4">Snake</li>
            <li id="param5">Syst√®me</li>
            <li id="param6">√Ä Propos</li>
        </ul>
     </div>
    <div class="param_content"></div>
`,f=new W,p=new F(f),v=new L(p),B=50,w="center",O=document.querySelector(".window_dock"),R=document.querySelector(".params_dock"),N=document.querySelector(".trash_dock"),I=document.querySelector(".snake_dock");new D;O.addEventListener("click",()=>{f.createNewWindow(w,"/folder-open.svg","test","<h1>Ma fen√™tre</h1>")});R.addEventListener("click",()=>{const l=f.createNewWindow(w,"/hammer.svg","Param√®tres",C);f.addBackgroundChangeHandler(l)});N.addEventListener("click",()=>{const l=v.trash.map(t=>p.createFolderElement(t.dataset.name,t.querySelector("img").src).outerHTML).join(""),e=f.createNewWindow(w,"/dumpster.svg","Poubelle",l);v.trash.forEach((t,s)=>{const i=e.querySelector(`.desktop-folder:nth-child(${s+1})`);v.addRestoreEvent(i)}),document.addEventListener("trashUpdated",()=>{v.updateTrashWindowContent()})});I.addEventListener("click",()=>{f.createNewWindow(w,"/gamepad.svg","Snake",p.launchSnake)});p.createLN("Mes dossiers","","/folder-open.svg","folder");p.createLN("Mon Dossier 2","test","/folder-open.svg","folder");p.createLN("Param√®tres POS",C,"/hammer.svg","system");p.createLN("Poubelle","","/dumpster.svg","system");p.createLN("Snake",p.launchSnake,"/gamepad.svg","game");p.setIconSize(B);p.updateIconSize();
